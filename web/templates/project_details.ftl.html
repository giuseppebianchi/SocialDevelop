
  
  <div class="compny-profile"> 
    <!-- SUB Banner -->
    <div class="profile-bnr overlay-up">
        <a class="overlay"></a>
      <div class="container overlay-up"> 
        
        <!-- User Iinfo -->
        <div class="user-info background-transparent">
          <h1>${projectname?cap_first}</h1>
          <!--<h6 id="${coordinator.key}">${coordinator.name?cap_first} ${coordinator.surname?cap_first}</h6>-->
          <h6>${projectcategory?cap_first}</h6>
           <span><div class="uou-progressbar-single">
                                        <a class="progress-percent">${percProg} %</a><span class="main-bar"> <span class="inner-bar" style="width: ${percProg}%"></span>  </span> 
                                        </div></span>
          <hr>
          <h6><a href="#">(${nTask})</a> Tasks  | <a href="#">${nProjectCollaborators}</a> Developers required</h6>
          <!-- Stars 
          <ul class="row">
            <li class="col-sm-6">
              
            </li>
            <li class="col-sm-6">
              
            </li>
          </ul>-->
          
          <!-- Followers 
          <div class="followr">
            <ul class="row">
              <li class="col-sm-6">
                <p>Tasks <span>(31)</span></p>
              </li>
              <li class="col-sm-6">
                <p>Following <span>(38)</span></p>
              </li>
            </ul>
          </div>-->
        </div>
        
        <!-- Top Riht Button -->
        <div class="right-top-bnr">
          <div class="connect"> 
            <!--<a href="#." class="btn btn-primary">3 June 2017</a>-->
            <#if auth_user??>
                <#if isCoordinator??>
                <a id="setting-project-button" href="${request.getContextPath()}/projects/settings/${projectkey}" class="btn btn-default"><i class="fa fa-cog"></i> Edit</a>
                <div class="bt-ns"> <a href="#."><i class="fa fa-bookmark-o"></i> </a> <a href="#."><i class="fa fa-thumbs-up"></i> </a>  </div>
                </#if>
            <#else>
            <div class="bt-ns"> <a href="#."><i class="fa fa-bookmark-o"></i> </a> <a href="#."><i class="fa fa-thumbs-up"></i> </a>  </div>
          </#if>
          </div>
        </div>
      </div>
      
      <!-- Modal POPUP 
      <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="container">
              <h6><a class="close" href="#." data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></a> Send Message</h6>
              
              <form action="#">
                <ul class="row">
                  <li class="col-xs-6">
                    <input type="text" placeholder="First Name ">
                  </li>
                  <li class="col-xs-6">
                    <input type="text" placeholder="Last Name">
                  </li>
                  <li class="col-xs-6">
                    <input type="text" placeholder="Country">
                  </li>
                  <li class="col-xs-6">
                    <input type="text" placeholder="Email">
                  </li>
                  <li class="col-xs-12">
                    <textarea placeholder="Your Message"></textarea>
                  </li>
                  <li class="col-xs-12">
                    <button class="btn btn-primary">Send message</button>
                  </li>
                </ul>
              </form>
            </div>
          </div>
        </div>
      </div>-->
    </div>
    
    <!-- Profile Company Content -->
    <div class="profile-company-content main-user project-page" data-bg-color="f5f5f5">
      <div class="container">
        <div class="row"> 
          
          <!-- Nav Tabs -->
          <div class="col-md-12 ">
            <ul class="nav nav-tabs">
              <li class="active"><a data-toggle="tab" href="#profile">Project</a></li>
              <li><a data-toggle="tab" href="#jobs">Tasks</a></li>
              <li><a data-toggle="tab" href="#connections">Developers</a></li>
              <li><a data-toggle="tab" href="#discussion">Discussion</a></li>
            </ul>
              <hr>
          </div>
          
          
          
          
          <!-- Tab Content -->
          <div class="col-md-12">
            <div class="tab-content"> 
              
              <!-- PROFILE -->
              <div id="profile" class="tab-pane fade in active">
              <!-- SIDE BAR -->
              <h3 class="tab-title">Project</h3>
              <p class="tab-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit, maxime, excepturi, mollitia, voluptatibus similique aliquid a dolores autem laudantium sapiente ad enim ipsa modi laborum accusantium deleniti neque architecto vitae.</p>
              <hr>
              <div class="row">
                <div class="col-md-12">
                  <div class="profile-main">
                      <h3 class="tab-title">Category</h3>
                      <h5>${projectcategory}</h5>
                      <hr>
                    <h3 class="tab-title">About</h3>
                    <div class="tab-content-body">
                      ${projectdescr?no_esc}
                    </div>
                </div>
                
                    <hr>
          </div>
          <div class="col-md-12 similar"> 
              <h3 class="tab-title">Company</h3>
                      <p>${projectcompany}</p>
                      <hr>
                      <h3 class="tab-title">Location</h3>
                      <p>${projectlocation}</p>
                      <hr>
                  <!-- DEVELOPER -->
                  <h3 class="tab-title">Project's Coordinator</h3>
                  <p class="tab-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit, maxime, excepturi, mollitia.</p>
          <div class="developer-list">
          <div class="media">
            <div class="media-left">
                <div class="inn-simi"> <div class="media-object" <#if coordinator.picture??>style="background-image:url('${request.getContextPath()}/uploads/images/${coordinator.picture}')"</#if> alt=""></div></div>
            </div>
            <div class="media-body">
              <h4>${coordinator.name} ${coordinator.surname}</h4>
              <p>${coordinator.headline}</p>
              <div class="com-rate"><span>
                    <#list 1..5 as i>
                        <#if (i > vote)>
                        <i class="fa fa-star-o"></i>
                        <#else>
                        <i class="fa fa-star"></i>
                        </#if>
                    </#list></span></div>
              
              <div>
                  <#assign dec = coordinator.getTextBio()>
                    <#if (dec?length > 251)>
                        ${dec?substring(0, 250)}... <a href="${request.getContextPath()}/developers/${coordinator.key}">read more</a>
                    <#else>
                       ${dec} <a href="${request.getContextPath()}/developers/${coordinator.key}"> read more</a>
                    </#if>
              </div>
              
              
              <!-- Share 
              <div class="share-w"><a href="#."><i class="fa fa-bookmark-o"></i></a> <a href="#."><i class="fa fa-envelope-o"></i></a> <a href="#."><i class="fa fa-eye"></i></a></div>
              -->
            </div>
          </div>
          <!-- END DEVELOPER -->
          </div>
       
                  <!-- Company Rating
                  <div class="sidebar">
                    <h5 class="main-title">Developer Rating</h5>
                    <div class="sidebar-information">
                      <ul class="single-category com-rate">
                        <li class="row">
                          <h6 class="title col-xs-6">Expertise:</h6>
                          <span class="col-xs-6"><i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span> </li>
                        <li class="row">
                          <h6 class="title col-xs-6">Knowledge:</h6>
                          <span class="col-xs-6"><i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star-half-o"></i> <i class="fa fa-star-o"></i></span> </li>
                        <li class="row">
                          <h6 class="title col-xs-6">Quality::</h6>
                          <span class="col-xs-6"><i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star-o"></i></span> </li>
                      </ul>
                    </div>
                  </div> -->
                  
                  
                </div>
          </div>
              </div>
              
              <!-- Jobs -->
              <div id="jobs" class="tab-pane fade">
                  <h3 class="tab-title">Tasks (<span class="text-primary">${nTask}</span>)</h3>
              <p class="tab-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit, maxime, excepturi, mollitia, voluptatibus similique aliquid a dolores autem laudantium sapiente ad enim ipsa modi laborum accusantium deleniti neque architecto vitae.</p>
                <ul class="nav nav-tabs">
                    <li><a>${tasks_completed} <span class="text-primary">Completed</span></a></li>
                    <li><a>${tasks_open} <span class="text-success">Open</span></a></li>
                    <li><a>${tasks_closed} <span class="text-danger">Closed</span></a></li>
                    
                </ul>
              <hr>
                <div class="listing listing-1">
                  <div class="listing-section">
                      
                   <#list tasks as task>
                    <div class="listing-ver-3 task-item">
                      <div class="listing-heading">
                          <a href="${request.getContextPath()}/projects/tasks/${task.key}"><h5><#if task.isCompleted()><i class="fa fa-check-circle text-primary"></i><#else><#if task.open><i class="fa fa-folder-open text-success"></i><#else><i class="fa fa-dot-circle-o text-danger"></i></#if></#if> ${task.name}</h5></a>
                        <#if auth_user??>
                            <#if isCoordinator??>
                                <ul class="bookmark list-inline">
                                  <li><a href="${request.getContextPath()}/projects/tasks/settings/${task.key}"><i class="fa fa-cog"></i></a></li>
                                </ul>
                            </#if>
                        </#if>
                      </div>
                      <div class="listing-inner">
                        <div class="listing-content">
                          <h6 class="title-company">${tasks_types[task?index].type}</h6>
                          <span class="location"> <i class="fa fa-map-marker"></i> Manhattan, New york, USA </span> <!--<span class="text-success"> Start Date</span>: ${task.getStartDate().time?date?string.short} |  <span class="text-danger">End Date</span>: ${task.getEndDate().time?date?string.short}-->
                          <div>
                            <#assign dec = task.getTextDescription()>
                            <#if (dec?length > 251)>
                            <div class="p10">${dec?substring(0, 250)}... <a href="${request.getContextPath()}/projects/${task.key}">read more</a></div>
                            <#else>
                                <div class="p10">${dec} <a href="${request.getContextPath()}/projects/${task.key}"> read more</a></div>
                            </#if>
                          </div>
                          <h6 class="title-tags">Skills required:</h6>
                          <ul class="tags list-inline">
                            <#list skills[task?index] as key,value>
                            <li><a href="">${key.name} <span>${value}</span> </a></li>
                        </#list>
                          </ul>
                        </div>
                      </div>
                      <div class="listing-tabs">
                        <ul>
                          <li class="hidden-xs"><#if task.isCompleted()><span class="text-primary">Completed</span><#else><#if task.open><span class="task-open">Open</span><#else><span class="task-closed">Closed</span></#if></#if></li>
                          <li><span><i class="fa fa-group text-primary"></i> <strong>${task.numCollaborators}</strong> Developers</span></li>
                          <li><span><i class="fa fa-clock-o text-primary"></i> ${task.getStartDate().time?date?string.short} <strong class="text-primary">|</strong> ${task.getEndDate().time?date?string.short}</span></li>
                          <li class="visible-xs"><#if task.open><span class="task-open">Open</span><#else><span class="task-closed">Closed</span></#if></li>
                          <li><a href="${request.getContextPath()}/projects/tasks/${task.key}"><span class="text-primary">Show Task <i class="fa fa-chevron-right"></i></span></a></li>
                        </ul>
                      </div>
                    </div>
                   </#list> 
                  </div>
                </div>
              </div>
              <div id="connections" class="tab-pane fade">
                  <#if auth_user??>
                <#if isCoordinator??>
                <a href="${request.getContextPath()}/projects/suggestions/${projectkey}" class="btn btn-primary pull-right">Find Developers</a>
                </#if>
              </#if>
              <h3 class="tab-title">Developers</h3>
              <p class="tab-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit, maxime, excepturi, mollitia, voluptatibus similique aliquid a dolores autem laudantium sapiente ad enim ipsa modi laborum accusantium deleniti neque architecto vitae.</p>
              
              <ul class="nav nav-tabs">
                    <li><a>${nProjectCollaborators} <span class="text-primary">Required</span></a></li>
                    <li><a>${hired} <span class="text-success">Hired</span></a></li>
                    <li><a>${nrequests} <span class="text-danger">Requests</span></a></li>
                </ul>
              <hr>
                <div class="">
                  <div class="similar developer-list">
                      <#if collaborators?has_content>
                      <#list collaborators as key, value>
                      <!-- DEVELOPER -->
          <div class="media">
            <div class="media-left">
                <div class="inn-simi"> <div class="media-object" <#if value.picture??>style="background-image:url('${request.getContextPath()}/uploads/images/${value.picture}')"</#if> alt=""></div></div>
            </div>
            <div class="media-body">
              <h4><a class="title-developer-list" href="${request.getContextPath()}/developers/${key}"><#if (value.name == "" && value.surname == "")>${value.username}<#else>${value.name} ${value.surname}</#if></a></h4>
              <p>${value.headline}</p>
              <div class="com-rate"><span>
                    <#list 1..5 as i>
                        <#if (i > votes[key?index])>
                        <i class="fa fa-star-o"></i>
                        <#else>
                        <i class="fa fa-star"></i>
                        </#if>
                    </#list>
              </span></div>
              <div>
                  <#assign dec = value.getTextBio()>
                    <#if (dec?length > 251)>
                        ${dec?substring(0, 250)}... <a href="${request.getContextPath()}/developers/${key}">read more</a>
                    <#else>
                       ${dec} <a href="${request.getContextPath()}/developers/${key}"> read more</a>
                    </#if>
              </div>
              <!--<span class="title-tags">Tasks:</span>
                          <ul class="tags list-inline">
                            
                          </ul>
              <!-- Share 
              <div class="share-w"><a href="#."><i class="fa fa-bookmark-o"></i></a> <a href="#."><i class="fa fa-envelope-o"></i></a> <a href="#."><i class="fa fa-eye"></i></a></div>-->
            </div>
          </div>
          <!-- END DEVELOPER -->
          </#list>
          <#else>
                <#if isCoordinator??>
                <a href="${request.getContextPath()}/projects/suggestions/${projectkey}"><h5>Find some developers for your project</h5>.</a>
                <#else>
                <h5>No developer has been hired for this project.</h5>
                </#if>
          </#if>
                    </div>

                </div>                
              </div>
              <!-- Contact -->
              <div id="discussion" class="tab-pane fade">
                  <h3 class="tab-title">Discussion</h3>
              <p class="tab-subtitle">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit, maxime, excepturi, mollitia, voluptatibus similique aliquid a dolores autem laudantium sapiente ad enim ipsa modi laborum accusantium deleniti neque architecto vitae.</p>
              <hr>
                  <div class="profile-in">
                    <div class="uou-post-comment">
                      <aside class="uou-block-14a">
                        <h5 class="sidebar-title">Comments (<span id="count-messages">${messages?size}</span>)</h5>
                        <br>
                        <ul id="messages-list">
                          <#if messages?has_content>
                          <#list messages as message>
                          <li>
                            <article class="comment">
                              <img src="${request.getContextPath()}/theme/images/p-post-1.png" alt="">

                              <div>
                                <header>
                                  <a href="#" class="user">${message.developer.getName()} ${message.developer.getSurname()}</a>
                                <#if message.isPrivate()>  
                                  <#if isCollaborator??>
                                      <span class="reply text-danger"><i class="fa fa-lock"></i></span>
                                    <#else>
                                        <span class="reply text-success"><i class="fa fa-globe"></i></span>
                                    </#if>
                                  <#else>
                                    <span class="reply text-success"><i class="fa fa-globe"></i></span>
                                  </#if>
                                  <a href="#" class="reply">${message.type}</a>
                                </header>
                                  <span class="time-ago"><!--May 13, 2015(11.25)-->${message.getDate().time?date?string.long}</span>
                                <p>${message.text}</p>
                              </div>
                            </article>
                          </li>
                         </#list>
                         <#else>
                         <h2>No message for this project.</h2>
                         </#if>
                        </ul>
                      <#if auth_user??>
                      <div id="alert-box"></div>
                      <div id="add-message-box">
                        <h4>Join Conversation</h4>
                        <div class="uou-post-comment-form">
                          <form id="form-message" role="form" action="${request.getContextPath()}/projects/messages/add_message">
                            <div class="row">

                              <div class="col-sm-12">
                                <textarea id="message-text" placeholder="Your comment" name="text"></textarea>
                                <input type="hidden" value="${projectkey}" name="id_project">
                              </div>
                            </div>
                              <div class="row">
                                  <div class="col-sm-3">
                                      <select id="select-type" name="type-message">
                                          <option value="1" selected="selected">Discussion</option>
                                          <option value="2">Ad</option>
                                          <option value="3">Request</option>
                                      </select>
                                </div>
                              <div class="col-sm-3">
                                  <#if isCollaborator??>
                                  <div class="checkbox mt10">
                                        <input id="checkbox1" class="styled" type="checkbox" name="private-checkbox">
                                        <label for="checkbox1 text-error"> Private</label>
                                  </div>
                                  </#if>
                                </div>
                              <div class="col-sm-6">
                                <button class="btn btn-primary pull-right btn-small" id="add-message" type="submit">Add Comment</button>
                              </div>
                                  

                            </div> <!-- end row -->
                          </form>
                        </div>
                      </div>
                      </#if>
                      </aside> <!-- end .uou-block-14a -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  $(document).ready(function(){
      var ctx = "${request.getContextPath()}";
      var textarea = $("#message-text");
      var type = $("#select-type");
      var private = $("#checkbox1");
      var list = $("#messages-list");
      var alert_box = $("#alert-box");
      var fullname = '${fullname}';
      var foto = "<#if profile_picture??>${request.getContextPath()}/uploads/images/${profile_picture}<#else>${request.getContextPath()}/uploads/images/blog-image-4.png</#if>";
      var messageTemplate;
      
        $.get(ctx + "/templates/mustache/messageTemplate.html", function(t){
                messageTemplate = t;
      });
      
      $("#form-message").submit(function(e){
          e.preventDefault();
          debugger;
          alert_box.html('');
          var text = textarea.val();
          var t = type.val();
          var p = 0;
          if(private.attr("checked")){
              p = 1;
          }
          var data = {
                text: text,
                type: t,
                private: p,
                project_key: ${projectkey}
          }
          $.ajax({
            datatype: 'text/plain',
            type: 'post',
            url: ctx + '/projects/messages/add_message',
            data: data,
            success: function (response) {
                debugger;
                var icon = "";
                if(p == 1){
                    icon ='<span class="reply text-danger"><i class="fa fa-lock"></i></span>';
                }else{
                    icon = '<span class="reply text-success"><i class="fa fa-globe"></i></span>';   
                }
                data.icon = icon;
                data.fullname = fullname;
                data.date = "Now";
                data.ctx = ctx;
                data.typet = type.find(":selected").text();
                if(response == 1){
                    list.append(Mustache.render(messageTemplate, data))
                    alert_box.html('<div class="alert alert-success alert-dismissible" role="alert"><button type="button" class="close">×</button><strong>Well done!</strong> Your message has been sent successfully. </div>');
                    $("#add-message-box").remove();
                }
                
            },
            error: function (data){
                console.log(data) 
                alert_box.html('<div class="alert alert-error alert-dismissible" role="alert"><button type="button" class="close">×</button><strong>Ops!</strong> Something went wrong. Try Later! </div>');
                debugger;
            }
        });
      });
  })
</script>